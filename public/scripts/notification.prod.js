"use strict";var response,container=document.getElementById("notifications"),toggle=document.getElementById("notifications-toggle"),unreadBadge=document.getElementById("unread-badge"),timezone=Intl.DateTimeFormat().resolvedOptions().timeZone;function loadNotifications(e){var t=new XMLHttpRequest;t.open("POST","./app/Controllers/NotificationController.php"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.onreadystatechange=function(){var e;4==this.readyState&&(response=JSON.parse(this.responseText),(e=document.createElement("div")).innerHTML=response.notifications,Array.from(e.children).forEach(function(e,t){var o,i;(o=e.querySelector("#confirm"))&&o.addEventListener("click",function(e){e.stopPropagation(),e.target.parentNode.innerHTML="Confirmado",notifAction("confirm",response.notif_requests[t])}),(o=e.querySelector("#refuse"))&&o.addEventListener("click",function(e){e.stopPropagation(),e.target.parentNode.innerHTML="Recusado",notifAction("refuse",response.notif_requests[t])}),(o=e.querySelector("#conclude"))&&o.addEventListener("click",function(e){e.stopPropagation(),e.target.parentNode.innerHTML="Concluído",notifAction("conclude",response.notif_requests[t])}),(o=e.querySelector("#rate"))&&(e.querySelectorAll(".stars-rating svg").forEach(function(t){var n=!1;t.addEventListener("mouseenter",function(){t.setAttribute("star","full");var e=t.nextElementSibling;if(e)for(e.setAttribute("star","empty");e=e.nextElementSibling;)e.setAttribute("star","empty");if(e=t.previousElementSibling)for(e.setAttribute("star","full");e=e.previousElementSibling;)e.setAttribute("star","full");i=null,n=!1,o.setAttribute("disabled","")}),t.addEventListener("click",function(){i=t.getAttribute("value"),n=!0,o.removeAttribute("disabled")}),t.addEventListener("mouseleave",function(){0==n&&Array.from(t.parentNode.children).forEach(function(e){return e.setAttribute("star","empty")})})}),o.addEventListener("click",function(e){e.stopPropagation(),e.target.parentNode.innerHTML="Avaliado",notifAction("rate",response.notif_requests[t],i)})),container.prepend(e)}),1<container.children.length&&"Suas notificações aparecerão aqui."==container.lastChild.innerHTML&&container.lastChild.remove(),unreadBadge.innerHTML=Number(unreadBadge.innerHTML)+response.unread_count||null,loadNotifications("notif_method=show&latest&timezone=".concat(timezone)))},t.send(e)}function notifAction(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=new XMLHttpRequest;o.open("POST","./app/Controllers/NotificationController.php"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),n?o.send("notif_method=".concat(e,"&notif_request=").concat(t,"&rate=").concat(n)):o.send("notif_method=".concat(e,"&notif_request=").concat(t))}loadNotifications("notif_method=show&timezone=".concat(timezone)),toggle.addEventListener("click",function(){var e;response.unread_count&&unreadBadge.innerHTML&&((e=new XMLHttpRequest).open("POST","./app/Controllers/NotificationController.php"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.onreadystatechange=function(){4==this.readyState&&(unreadBadge.innerHTML=null,setTimeout(function(){document.querySelectorAll("#notifications > div").forEach(function(e){e.classList.contains("text-black-50")||e.classList.add("text-black-50")})},5e3))},e.send("notif_method=read_all"))});